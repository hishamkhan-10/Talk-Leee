"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[595],{"./src/components/campaigns/event-stream.stories.tsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>event_stream_stories});var AnimatePresence=__webpack_require__("./node_modules/framer-motion/dist/es/components/AnimatePresence/index.mjs"),proxy=__webpack_require__("./node_modules/framer-motion/dist/es/render/components/motion/proxy.mjs"),react=__webpack_require__("./node_modules/react/index.js"),campaign_performance=__webpack_require__("./src/lib/campaign-performance.ts"),ui_button=__webpack_require__("./src/components/ui/button.tsx"),modal=__webpack_require__("./src/components/ui/modal.tsx"),utils=__webpack_require__("./src/lib/utils.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function EventStream({campaigns,initialEvents}){const[events,setEvents]=(0,react.useState)(()=>initialEvents||function seedEvents(campaigns){const now=Date.now(),pick=idx=>campaigns[idx%Math.max(1,campaigns.length)]?.id;return[{id:"evt-"+(now-1e3),category:"Campaign",title:"Campaign started",description:"Holiday Sales Outreach began processing new leads.",createdAt:new Date(now-72e4).toISOString(),relatedCampaignIds:pick(0)?[pick(0)]:[],metadata:{queueDepth:42,operator:"scheduler"}},{id:"evt-"+(now-2e3),category:"System",title:"Worker pool scaled",description:"System scaled worker pool from 6 → 10 to handle traffic spike.",createdAt:new Date(now-48e5).toISOString(),metadata:{from:6,to:10}},{id:"evt-"+(now-3e3),category:"Alerts",title:"Retry rate elevated",description:"Outbound retry rate exceeded threshold for 5 minutes.",createdAt:new Date(now-72e5).toISOString(),metadata:{rate:"7.2%",threshold:"5.0%"}},{id:"evt-"+(now-4e3),category:"User Actions",title:"Campaign paused",description:"Operator paused Customer Satisfaction Survey for script review.",createdAt:new Date(now-936e5).toISOString(),relatedCampaignIds:pick(1)?[pick(1)]:[],metadata:{user:"Alex"}},{id:"evt-"+(now-5e3),category:"Milestones",title:"Goal reached",description:"Appointment Reminders hit 95% completion milestone.",createdAt:new Date(now-7776e5).toISOString(),relatedCampaignIds:pick(2)?[pick(2)]:[],metadata:{completion:"95%"}}]}(campaigns)),[quick,setQuick]=(0,react.useState)("All"),[sound,setSound]=(0,react.useState)(!1),[desktop,setDesktop]=(0,react.useState)(!1),[detailsId,setDetailsId]=(0,react.useState)(null),[lastId,setLastId]=(0,react.useState)(null);(0,react.useEffect)(()=>{const saved=function fromLocalStorage(key,fallback){try{const raw=window.localStorage.getItem(key);return raw?JSON.parse(raw):fallback}catch{return fallback}}("campaigns.performance.eventPrefs",{sound:!1,desktop:!1,quick:"All"}),raf=window.requestAnimationFrame(()=>{setSound(Boolean(saved.sound)),setDesktop(Boolean(saved.desktop)),setQuick(saved.quick||"All")});return()=>window.cancelAnimationFrame(raf)},[]),(0,react.useEffect)(()=>{!function toLocalStorage(key,value){try{window.localStorage.setItem(key,JSON.stringify(value))}catch{}}("campaigns.performance.eventPrefs",{sound,desktop,quick})},[desktop,quick,sound]),(0,react.useEffect)(()=>{desktop&&"Notification"in window&&"granted"!==Notification.permission&&Notification.requestPermission().catch(()=>{})},[desktop]),(0,react.useEffect)(()=>{const interval=window.setInterval(()=>{const next=function generateEvent(campaigns){const now=Date.now(),roll=now%5,c=campaigns.length>0?campaigns[now%campaigns.length]:null;if(0===roll)return{id:`evt-${now}`,category:"Campaign",title:"Campaign progress updated",description:`${c?.name||"A campaign"} processed a new batch of calls.`,createdAt:new Date(now).toISOString(),relatedCampaignIds:c?[c.id]:[],metadata:{processed:25,window:"5m"}};if(1===roll)return{id:`evt-${now}`,category:"System",title:"API latency normalizing",description:"System observed latency returning to baseline after brief spike.",createdAt:new Date(now).toISOString(),metadata:{p95:"210ms",baseline:"160ms"}};if(2===roll)return{id:`evt-${now}`,category:"Alerts",title:"Carrier errors detected",description:"Carrier error codes increased on outbound calls, retry policy engaged.",createdAt:new Date(now).toISOString(),relatedCampaignIds:c?[c.id]:[],metadata:{code:"486",retries:"enabled"}};if(3===roll)return{id:`evt-${now}`,category:"User Actions",title:"Settings updated",description:"Operator updated campaign script and concurrency settings.",createdAt:new Date(now).toISOString(),relatedCampaignIds:c?[c.id]:[],metadata:{user:"Operator",field:"concurrency"}};return{id:`evt-${now}`,category:"Milestones",title:"Completion milestone",description:`${c?.name||"A campaign"} reached a progress milestone.`,createdAt:new Date(now).toISOString(),relatedCampaignIds:c?[c.id]:[],metadata:{milestone:"70%"}}}(campaigns);if(setEvents(prev=>[next,...prev].slice(0,120)),setLastId(next.id),sound&&function beep(){try{const WebkitAudioContext=window.webkitAudioContext,AudioCtx=window.AudioContext??WebkitAudioContext;if(!AudioCtx)return;const ctx=new AudioCtx,o=ctx.createOscillator(),g=ctx.createGain();o.type="sine",o.frequency.value=880,g.gain.value=.02,o.connect(g),g.connect(ctx.destination),o.start();const t=window.setTimeout(()=>{o.stop(),ctx.close(),window.clearTimeout(t)},120)}catch{}}(),desktop&&"Notification"in window&&"granted"===Notification.permission)try{new Notification(next.title,{body:next.description.slice(0,140)})}catch{}},9e3);return()=>window.clearInterval(interval)},[campaigns,desktop,sound]);const filtered=(0,react.useMemo)(()=>(0,campaign_performance.qb)(events,quick),[events,quick]),grouped=(0,react.useMemo)(()=>function group(events){const out={Today:[],Yesterday:[],"Last 7 Days":[],Older:[]};for(const e of events){const g=(0,campaign_performance.D7)(e.createdAt);out[g].push(e)}return Object.keys(out).forEach(k=>out[k].sort((a,b)=>+new Date(b.createdAt)-+new Date(a.createdAt))),out}(filtered),[filtered]),details=(0,react.useMemo)(()=>events.find(e=>e.id===detailsId)||null,[detailsId,events]),relatedCampaigns=(0,react.useMemo)(()=>{if(!details?.relatedCampaignIds||0===details.relatedCampaignIds.length)return[];const set=new Set(details.relatedCampaignIds);return campaigns.filter(c=>set.has(c.id))},[campaigns,details]);return(0,jsx_runtime.jsxs)("div",{className:"content-card",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Event Stream"}),(0,jsx_runtime.jsx)("div",{className:"mt-1 text-sm text-gray-400",children:"Realtime operational activity and system signals."})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:["All","Campaigns","System","Alerts","User Actions"].map(k=>(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:quick===k?"secondary":"outline",size:"sm",onClick:()=>setQuick(k),children:k},k))})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,jsx_runtime.jsxs)("label",{className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 px-3 py-2",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Sound notifications"}),(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:sound,onChange:e=>setSound(e.target.checked),className:"h-4 w-4 rounded border-white/20 bg-white/5"})]}),(0,jsx_runtime.jsxs)("label",{className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 px-3 py-2",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Desktop notifications"}),(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:desktop,onChange:e=>setDesktop(e.target.checked),className:"h-4 w-4 rounded border-white/20 bg-white/5"})]})]}),(0,jsx_runtime.jsx)("div",{className:"mt-4 space-y-5",children:Object.keys(grouped).map(g=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold text-gray-300",children:g}),(0,jsx_runtime.jsx)("div",{className:"mt-2 space-y-2",children:(0,jsx_runtime.jsx)(AnimatePresence.N,{initial:!1,children:grouped[g].slice(0,20).map(e=>(0,jsx_runtime.jsxs)(proxy.P.button,{type:"button",className:(0,utils.cn)("flex w-full items-start gap-3 rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-left hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/30",e.id===lastId?"ring-1 ring-white/15":""),initial:{x:18,opacity:0},animate:{x:0,opacity:1},exit:{opacity:0},transition:{duration:.18},onClick:()=>setDetailsId(e.id),children:[(0,jsx_runtime.jsx)("div",{className:"pt-0.5 text-lg",children:(0,campaign_performance.Y_)(e.category)}),(0,jsx_runtime.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,jsx_runtime.jsx)("div",{className:"truncate text-sm font-semibold text-white",children:e.title}),(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold text-gray-400 tabular-nums",children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,jsx_runtime.jsx)("div",{className:"mt-1 line-clamp-2 text-sm text-gray-300",children:e.description})]})]},e.id))})})]},g))}),(0,jsx_runtime.jsx)(modal.a,{open:null!==detailsId,onOpenChange:next=>setDetailsId(next?detailsId:null),title:details?details.title:"Event Details",description:details?`${details.category} • ${new Date(details.createdAt).toLocaleString()}`:void 0,size:"lg",children:details?(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Full description"}),(0,jsx_runtime.jsx)("div",{className:"mt-2 text-sm text-gray-200 whitespace-pre-wrap",children:details.description})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Related campaigns"}),(0,jsx_runtime.jsx)("div",{className:"mt-2 space-y-2",children:0===relatedCampaigns.length?(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-400",children:"—"}):relatedCampaigns.map(c=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,jsx_runtime.jsxs)("div",{className:"min-w-0",children:[(0,jsx_runtime.jsx)("div",{className:"truncate text-sm font-semibold text-white",children:c.name}),(0,jsx_runtime.jsx)("div",{className:"truncate text-xs font-semibold text-gray-400",children:c.id})]}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",asChild:!0,children:(0,jsx_runtime.jsx)("a",{href:`/campaigns/${c.id}`,children:"Open"})})]},c.id))})]}),(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Metadata"}),(0,jsx_runtime.jsx)("div",{className:"mt-2 space-y-2",children:details.metadata&&Object.keys(details.metadata).length>0?Object.entries(details.metadata).map(([k,v])=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-300",children:k}),(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white tabular-nums",children:String(v)})]},k)):(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-400",children:"—"})})]})]}),(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Action history"}),(0,jsx_runtime.jsxs)("div",{className:"mt-2 space-y-2 text-sm text-gray-300",children:[(0,jsx_runtime.jsxs)("div",{children:["Created • ",new Date(details.createdAt).toLocaleString()]}),(0,jsx_runtime.jsxs)("div",{children:["Viewed • ",(new Date).toLocaleString()]})]})]})]}):null})]})}EventStream.__docgenInfo={description:"",methods:[],displayName:"EventStream",props:{campaigns:{required:!0,tsType:{name:"Array",elements:[{name:"Campaign"}],raw:"Campaign[]"},description:""},initialEvents:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n    id: string;\n    category: EventCategory;\n    title: string;\n    description: string;\n    createdAt: string;\n    relatedCampaignIds?: string[];\n    metadata?: Record<string, string | number | boolean>;\n}",signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"category",value:{name:"union",raw:'"Campaign" | "System" | "Alerts" | "User Actions" | "Milestones"',elements:[{name:"literal",value:'"Campaign"'},{name:"literal",value:'"System"'},{name:"literal",value:'"Alerts"'},{name:"literal",value:'"User Actions"'},{name:"literal",value:'"Milestones"'}],required:!0}},{key:"title",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!0}},{key:"createdAt",value:{name:"string",required:!0}},{key:"relatedCampaignIds",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"metadata",value:{name:"Record",elements:[{name:"string"},{name:"union",raw:"string | number | boolean",elements:[{name:"string"},{name:"number"},{name:"boolean"}]}],raw:"Record<string, string | number | boolean>",required:!1}}]}}],raw:"StreamEvent[]"},description:""}}};const event_stream_stories={title:"Campaigns/EventStream",component:EventStream,args:{campaigns:[{id:"camp-001",name:"Holiday Sales Outreach",description:"End of year promotional campaign for existing customers",status:"running",system_prompt:"You are a friendly sales representative...",voice_id:"voice-001",max_concurrent_calls:10,total_leads:500,calls_completed:342,calls_failed:45,created_at:"2025-12-15T10:00:00Z",started_at:"2025-12-16T09:00:00Z"}]}},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}}}]);