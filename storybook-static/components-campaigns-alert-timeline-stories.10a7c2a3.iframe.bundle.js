"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[208],{"./src/components/campaigns/alert-timeline.stories.tsx"(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>alert_timeline_stories});var react=__webpack_require__("./node_modules/react/index.js"),ui_button=__webpack_require__("./src/components/ui/button.tsx"),modal=__webpack_require__("./src/components/ui/modal.tsx"),campaign_performance=__webpack_require__("./src/lib/campaign-performance.ts"),utils=__webpack_require__("./src/lib/utils.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function typeBadgeClass(type){switch(type){case"Network":return"bg-fuchsia-500/15 text-fuchsia-200 border border-fuchsia-500/25";case"API":return"bg-cyan-500/15 text-cyan-200 border border-cyan-500/25";case"Campaign":return"bg-emerald-500/15 text-emerald-200 border border-emerald-500/25";default:return"bg-slate-500/15 text-slate-200 border border-slate-500/25"}}function statusBadgeClass(status){switch(status){case"Active":return"bg-red-500/10 text-red-200 border border-red-500/20";case"Investigating":return"bg-orange-500/10 text-orange-200 border border-orange-500/20";case"Resolved":return"bg-emerald-500/10 text-emerald-200 border border-emerald-500/20";default:return"bg-slate-500/10 text-slate-200 border border-slate-500/20"}}function AlertTimeline({campaigns}){const[alerts,setAlerts]=(0,react.useState)(()=>function seedAlerts(campaigns){const now=Date.now(),c=campaigns[0]?.id;return[{id:"al-"+(now-1),title:"Carrier error spike",description:"Increased carrier error codes detected on outbound calls, retries engaged.",severity:"Critical",type:"Network",status:"Active",createdAt:new Date(now-108e4).toISOString(),updatedAt:new Date(now-36e4).toISOString(),acknowledged:!1,relatedCampaignIds:c?[c]:[],metadata:{code:"486",p95_ms:540}},{id:"al-"+(now-2),title:"API throttling warning",description:"Upstream API returned 429 responses above threshold for 3 minutes.",severity:"Warning",type:"API",status:"Investigating",createdAt:new Date(now-33e5).toISOString(),updatedAt:new Date(now-12e5).toISOString(),acknowledged:!0,metadata:{route:"/calls",rate:"12/min"}},{id:"al-"+(now-3),title:"Campaign completion delayed",description:"Campaign completion ETA extended due to lead pacing settings.",severity:"Info",type:"Campaign",status:"Resolved",createdAt:new Date(now-1008e5).toISOString(),updatedAt:new Date(now-72e6).toISOString(),acknowledged:!0,metadata:{eta:"2h"}}]}(campaigns)),[sev,setSev]=(0,react.useState)(new Set),[type,setType]=(0,react.useState)(new Set),[status,setStatus]=(0,react.useState)(new Set),[detailsId,setDetailsId]=(0,react.useState)(null),[ruleOpen,setRuleOpen]=(0,react.useState)(!1),[tab,setTab]=(0,react.useState)("Impact Analysis");(0,react.useEffect)(()=>{const saved=function fromLocalStorage(key,fallback){try{const raw=window.localStorage.getItem(key);return raw?JSON.parse(raw):fallback}catch{return fallback}}("campaigns.performance.alertPrefs",{sev:[],type:[],status:[]}),raf=window.requestAnimationFrame(()=>{setSev(new Set(saved.sev||[])),setType(new Set(saved.type||[])),setStatus(new Set(saved.status||[]))});return()=>window.cancelAnimationFrame(raf)},[]),(0,react.useEffect)(()=>{!function toLocalStorage(key,value){try{window.localStorage.setItem(key,JSON.stringify(value))}catch{}}("campaigns.performance.alertPrefs",{sev:Array.from(sev),type:Array.from(type),status:Array.from(status)})},[sev,status,type]);const filtered=(0,react.useMemo)(()=>{const now=new Date;return alerts.filter(a=>!(0,campaign_performance.Xv)(a,now)&&(!(sev.size>0&&!sev.has(a.severity))&&(!(type.size>0&&!type.has(a.type))&&!(status.size>0&&!status.has(a.status)))))},[alerts,sev,status,type]),details=(0,react.useMemo)(()=>alerts.find(a=>a.id===detailsId)||null,[alerts,detailsId]),updateAlert=(id,updater)=>{setAlerts(prev=>prev.map(a=>a.id===id?updater(a):a))},footerButtons=details?(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",onClick:()=>updateAlert(details.id,a=>({...a,acknowledged:!0,updatedAt:(new Date).toISOString()})),children:"Acknowledge"}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",onClick:()=>updateAlert(details.id,a=>({...a,status:"Investigating",updatedAt:(new Date).toISOString()})),children:"Investigate"}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",onClick:()=>updateAlert(details.id,a=>({...a,status:"Resolved",updatedAt:(new Date).toISOString()})),children:"Resolve"}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",onClick:()=>updateAlert(details.id,a=>({...a,severity:"Critical"===a.severity||"Warning"===a.severity?"Critical":"Warning",updatedAt:(new Date).toISOString()})),children:"Escalate"}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",onClick:()=>updateAlert(details.id,a=>({...a,snoozedUntil:new Date(Date.now()+18e5).toISOString(),updatedAt:(new Date).toISOString()})),children:"Snooze"}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"secondary",size:"sm",onClick:()=>setRuleOpen(!0),children:"Create Rule"})]}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",onClick:()=>setDetailsId(null),children:"Close"})]}):null;return(0,jsx_runtime.jsxs)("div",{className:"content-card",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Error & Alert Timeline"}),(0,jsx_runtime.jsx)("div",{className:"mt-1 text-sm text-gray-400",children:"Track, triage, and resolve incidents."})]}),(0,jsx_runtime.jsxs)("div",{className:"text-sm font-semibold text-gray-300",children:[filtered.length," alerts"]})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-3",children:[(0,jsx_runtime.jsx)(FilterPills,{label:"Severity",options:["Critical","Warning","Info"],value:sev,onChange:next=>setSev(next),classFor:v=>(0,campaign_performance.TA)(v)}),(0,jsx_runtime.jsx)(FilterPills,{label:"Type",options:["Network","API","Campaign","System"],value:type,onChange:next=>setType(next),classFor:v=>typeBadgeClass(v)}),(0,jsx_runtime.jsx)(FilterPills,{label:"Status",options:["Active","Resolved","Investigating"],value:status,onChange:next=>setStatus(next),classFor:v=>statusBadgeClass(v)})]}),(0,jsx_runtime.jsx)("div",{className:"mt-4 space-y-2",children:filtered.map(a=>(0,jsx_runtime.jsxs)("button",{type:"button",className:"flex w-full items-start justify-between gap-3 rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-left hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/30",onClick:()=>{setTab("Impact Analysis"),setDetailsId(a.id)},children:[(0,jsx_runtime.jsxs)("div",{className:"min-w-0",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:(0,utils.cn)("inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",(0,campaign_performance.TA)(a.severity)),children:a.severity}),(0,jsx_runtime.jsx)("span",{className:(0,utils.cn)("inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",typeBadgeClass(a.type)),children:a.type}),(0,jsx_runtime.jsx)("span",{className:(0,utils.cn)("inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",statusBadgeClass(a.status)),children:a.status}),a.acknowledged?null:(0,jsx_runtime.jsx)("span",{className:"inline-flex items-center rounded-full bg-white/10 px-2 py-0.5 text-xs font-semibold text-white",children:"New"})]}),(0,jsx_runtime.jsx)("div",{className:"mt-2 truncate text-sm font-semibold text-white",children:a.title}),(0,jsx_runtime.jsx)("div",{className:"mt-1 line-clamp-2 text-sm text-gray-300",children:a.description})]}),(0,jsx_runtime.jsxs)("div",{className:"shrink-0 text-right text-xs font-semibold text-gray-400",children:[(0,jsx_runtime.jsx)("div",{children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,jsx_runtime.jsx)("div",{className:"mt-1",children:new Date(a.createdAt).toLocaleDateString()})]})]},a.id))}),(0,jsx_runtime.jsx)(modal.a,{open:null!==detailsId,onOpenChange:next=>setDetailsId(next?detailsId:null),title:details?details.title:"Alert details",description:details?`${details.severity} • ${details.type} • ${details.status}`:void 0,size:"xl",footer:footerButtons,children:details?(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:["Impact Analysis","Root Cause","Timeline Visualization","Recommended Actions","Related Incidents"].map(t=>(0,jsx_runtime.jsx)(ui_button.$,{type:"button",size:"sm",variant:tab===t?"secondary":"outline",onClick:()=>setTab(t),children:t},t))}),(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:["Impact Analysis"===tab?(0,jsx_runtime.jsx)(ImpactPanel,{alert:details,campaigns}):null,"Root Cause"===tab?(0,jsx_runtime.jsx)(RootCausePanel,{alert:details}):null,"Timeline Visualization"===tab?(0,jsx_runtime.jsx)(TimelinePanel,{alert:details}):null,"Recommended Actions"===tab?(0,jsx_runtime.jsx)(RecommendedPanel,{alert:details}):null,"Related Incidents"===tab?(0,jsx_runtime.jsx)(RelatedPanel,{alert:details}):null]})]}):null}),(0,jsx_runtime.jsx)(modal.a,{open:ruleOpen,onOpenChange:setRuleOpen,title:"Rule builder",description:"Create an alert rule (prototype mode).",size:"lg",children:(0,jsx_runtime.jsx)(RuleBuilder,{onDone:()=>setRuleOpen(!1)})})]})}function FilterPills({label,options,value,onChange,classFor}){return(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold text-gray-300",children:label}),(0,jsx_runtime.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[options.map(o=>(0,jsx_runtime.jsx)("button",{type:"button",className:(0,utils.cn)("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/30",value.has(o)?classFor(o):"border border-white/10 bg-white/5 text-gray-200 hover:bg-white/10"),"aria-pressed":value.has(o),onClick:()=>(v=>{const next=new Set(value);next.has(v)?next.delete(v):next.add(v),onChange(next)})(o),children:o},o)),value.size>0?(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>onChange(new Set),children:"Clear"}):null]})]})}function ImpactPanel({alert,campaigns}){const related=(0,react.useMemo)(()=>{if(!alert.relatedCampaignIds||0===alert.relatedCampaignIds.length)return[];const set=new Set(alert.relatedCampaignIds);return campaigns.filter(c=>set.has(c.id))},[alert.relatedCampaignIds,campaigns]);return(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Impact Analysis"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-200",children:alert.description}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold text-gray-300",children:"Scope"}),(0,jsx_runtime.jsxs)("div",{className:"mt-2 space-y-1 text-sm text-gray-200",children:[(0,jsx_runtime.jsxs)("div",{children:["Start: ",new Date(alert.createdAt).toLocaleString()]}),(0,jsx_runtime.jsxs)("div",{children:["Last update: ",new Date(alert.updatedAt).toLocaleString()]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold text-gray-300",children:"Related campaigns"}),(0,jsx_runtime.jsx)("div",{className:"mt-2 space-y-2",children:0===related.length?(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-400",children:"—"}):related.map(c=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,jsx_runtime.jsxs)("div",{className:"min-w-0",children:[(0,jsx_runtime.jsx)("div",{className:"truncate text-sm font-semibold text-white",children:c.name}),(0,jsx_runtime.jsx)("div",{className:"truncate text-xs font-semibold text-gray-400",children:c.id})]}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",size:"sm",asChild:!0,children:(0,jsx_runtime.jsx)("a",{href:`/campaigns/${c.id}`,children:"Open"})})]},c.id))})]})]})]})}function RootCausePanel({alert}){return(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Root Cause"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-200",children:"Prototype analysis: likely upstream dependency behavior, transient network conditions, or campaign pacing configuration."}),(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold text-gray-300",children:"Metadata"}),(0,jsx_runtime.jsx)("div",{className:"mt-2 space-y-2",children:alert.metadata?Object.entries(alert.metadata).map(([k,v])=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-300",children:k}),(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white tabular-nums",children:String(v)})]},k)):(0,jsx_runtime.jsx)("div",{className:"text-sm text-gray-400",children:"—"})})]})]})}function TimelinePanel({alert}){const events=[{t:alert.createdAt,label:"Detected"},{t:new Date(new Date(alert.createdAt).getTime()+36e4).toISOString(),label:"Investigating"},{t:alert.updatedAt,label:"Latest update"}];return(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Timeline Visualization"}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:events.map(e=>(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-3 rounded-xl border border-white/10 bg-black/20 px-3 py-2",children:[(0,jsx_runtime.jsx)("div",{className:"mt-0.5 h-2 w-2 rounded-full bg-white/60"}),(0,jsx_runtime.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:e.label}),(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold text-gray-400 tabular-nums",children:new Date(e.t).toLocaleString()})]})]},e.t))})]})}function RecommendedPanel({alert}){return(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Recommended Actions"}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:["Acknowledge the alert and assign an owner.","Inspect network/API error codes and recent deployment changes.","Apply targeted retries or lower concurrency temporarily.","Create a rule to auto-escalate if conditions persist."].map(t=>(0,jsx_runtime.jsx)("div",{className:"rounded-xl border border-white/10 bg-black/20 px-3 py-2 text-sm text-gray-200",children:t},t))}),"Resolved"===alert.status?(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-emerald-200",children:"Status indicates the incident is resolved."}):null]})}function RelatedPanel({alert}){return(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold text-white",children:"Related Incidents"}),(0,jsx_runtime.jsxs)("div",{className:"rounded-xl border border-white/10 bg-black/20 p-3 text-sm text-gray-200",children:["Prototype view: no related incidents linked for ",alert.id,"."]})]})}function RuleBuilder({onDone}){const[name,setName]=(0,react.useState)("Auto-escalate carrier errors"),[condition,setCondition]=(0,react.useState)("type == Network AND severity >= Warning"),[action,setAction]=(0,react.useState)("Escalate severity to Critical");return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"text-xs font-semibold text-gray-300",children:"Rule name"}),(0,jsx_runtime.jsx)("input",{value:name,onChange:e=>setName(e.target.value),className:"mt-1 h-10 w-full rounded-md border border-white/10 bg-white/5 px-3 text-sm text-white"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"text-xs font-semibold text-gray-300",children:"Action"}),(0,jsx_runtime.jsx)("input",{value:action,onChange:e=>setAction(e.target.value),className:"mt-1 h-10 w-full rounded-md border border-white/10 bg-white/5 px-3 text-sm text-white"})]}),(0,jsx_runtime.jsxs)("div",{className:"md:col-span-2",children:[(0,jsx_runtime.jsx)("label",{className:"text-xs font-semibold text-gray-300",children:"Condition"}),(0,jsx_runtime.jsx)("textarea",{value:condition,onChange:e=>setCondition(e.target.value),className:"mt-1 h-24 w-full resize-none rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm text-white"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,jsx_runtime.jsx)(ui_button.$,{type:"button",variant:"outline",onClick:onDone,children:"Cancel"}),(0,jsx_runtime.jsx)(ui_button.$,{type:"button",onClick:()=>{try{const saved={name,condition,action,savedAt:(new Date).toISOString()},key="campaigns.performance.rules",prevRaw=window.localStorage.getItem(key),prev=prevRaw?JSON.parse(prevRaw):[];window.localStorage.setItem(key,JSON.stringify([saved,...prev||[]].slice(0,50)))}catch{}onDone()},children:"Save rule"})]})]})}AlertTimeline.__docgenInfo={description:"",methods:[],displayName:"AlertTimeline",props:{campaigns:{required:!0,tsType:{name:"Array",elements:[{name:"Campaign"}],raw:"Campaign[]"},description:""}}};const alert_timeline_stories={title:"Campaigns/AlertTimeline",component:AlertTimeline,args:{campaigns:[{id:"camp-001",name:"Holiday Sales Outreach",description:"End of year promotional campaign for existing customers",status:"running",system_prompt:"You are a friendly sales representative...",voice_id:"voice-001",max_concurrent_calls:10,total_leads:500,calls_completed:342,calls_failed:45,created_at:"2025-12-15T10:00:00Z",started_at:"2025-12-16T09:00:00Z"}]}},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}}}]);